058d6b1eed69a27f05d12a07fb0c462f
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.fetchEpic = void 0;

var Rx = _interopRequireWildcard(require("rxjs"));

var _error = require("../../../../utils/request/error");

var _action = require("../../../utils/action");

var actions = _interopRequireWildcard(require("../../actions"));

var _songs = _interopRequireDefault(require("../../../../api/songs"));

var fetchEpic = function fetchEpic(action$) {
  return action$.filter((0, _action.isActionOf)(actions.songsFetch)).mergeMap(function (_ref) {
    var payload = _ref.payload;
    return Rx.Observable.concat(Rx.Observable.of(actions.songsFetchLoading()), Rx.Observable.fromPromise(_songs.default.get(payload)).mergeMap(function (response) {
      return Rx.Observable.concat(Rx.Observable.of(actions.songsReceive(response)), Rx.Observable.of(actions.songsFetchSuccess()));
    }).catch(function (requestError) {
      return Rx.Observable.fromPromise((0, _error.parseRequestError)(requestError).then(function (error) {
        return actions.songsFetchFailure(error);
      }).catch(function (error) {
        return actions.songsFetchFailure(error);
      }));
    }));
  });
};

exports.fetchEpic = fetchEpic;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9rZWlzdWtla2lkby9wcm9qZWN0cy9pdHVuZXNGZXRjaGVyL3NyYy9zdGF0ZXMvc29uZ3MvZXBpYy9mZXRjaC9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFJQTs7QUFDQTs7QUFHQTs7QUFDQTs7QUFJTyxJQUFNLFNBQVMsR0FJbEIsU0FKUyxTQUlULENBQUEsT0FBTztBQUFBLFNBQ1QsT0FBTyxDQUNKLE1BREgsQ0FDVSx3QkFBVyxPQUFPLENBQUMsVUFBbkIsQ0FEVixFQUVHLFFBRkgsQ0FFWTtBQUFBLFFBQUcsT0FBSCxRQUFHLE9BQUg7QUFBQSxXQUNSLEVBQUUsQ0FBQyxVQUFILENBQWMsTUFBZCxDQUNFLEVBQUUsQ0FBQyxVQUFILENBQWMsRUFBZCxDQUFpQixPQUFPLENBQUMsaUJBQVIsRUFBakIsQ0FERixFQUVFLEVBQUUsQ0FBQyxVQUFILENBQWMsV0FBZCxDQUEwQixlQUFPLEdBQVAsQ0FBVyxPQUFYLENBQTFCLEVBQ0csUUFESCxDQUNZLFVBQUEsUUFBUTtBQUFBLGFBQ2hCLEVBQUUsQ0FBQyxVQUFILENBQWMsTUFBZCxDQUNFLEVBQUUsQ0FBQyxVQUFILENBQWMsRUFBZCxDQUFpQixPQUFPLENBQUMsWUFBUixDQUFxQixRQUFyQixDQUFqQixDQURGLEVBRUUsRUFBRSxDQUFDLFVBQUgsQ0FBYyxFQUFkLENBQWlCLE9BQU8sQ0FBQyxpQkFBUixFQUFqQixDQUZGLENBRGdCO0FBQUEsS0FEcEIsRUFPRyxLQVBILENBT1MsVUFBQyxZQUFEO0FBQUEsYUFDTCxFQUFFLENBQUMsVUFBSCxDQUFjLFdBQWQsQ0FBMEIsOEJBQWtCLFlBQWxCLEVBQ3ZCLElBRHVCLENBQ2xCLFVBQUEsS0FBSztBQUFBLGVBQUksT0FBTyxDQUFDLGlCQUFSLENBQTBCLEtBQTFCLENBQUo7QUFBQSxPQURhLEVBRXZCLEtBRnVCLENBRWpCLFVBQUEsS0FBSztBQUFBLGVBQUksT0FBTyxDQUFDLGlCQUFSLENBQTBCLEtBQTFCLENBQUo7QUFBQSxPQUZZLENBQTFCLENBREs7QUFBQSxLQVBULENBRkYsQ0FEUTtBQUFBLEdBRlosQ0FEUztBQUFBLENBSkoiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSeCBmcm9tICdyeGpzJztcbmltcG9ydCB7IEVwaWMgfSBmcm9tICdyZWR1eC1vYnNlcnZhYmxlJztcbmltcG9ydCB7IEFjdGlvbnNPZiB9IGZyb20gJ3R5cGVzL3N0YXRlJztcbmltcG9ydCB7IFJlcXVlc3RFcnJvciB9IGZyb20gJ3R5cGVzL3JlcXVlc3QnO1xuaW1wb3J0IHsgcGFyc2VSZXF1ZXN0RXJyb3IgfSBmcm9tICd1dGlscy9yZXF1ZXN0L2Vycm9yJztcbmltcG9ydCB7IGlzQWN0aW9uT2YgfSBmcm9tICdzdGF0ZXMvdXRpbHMvYWN0aW9uJztcbmltcG9ydCB7IFJvb3RTdGF0ZSB9IGZyb20gJ3N0YXRlcy9yb290L3JlZHVjZXInO1xuaW1wb3J0IHsgUm9vdEFjdGlvbnMgfSBmcm9tICdzdGF0ZXMvcm9vdC9hY3Rpb25zJztcbmltcG9ydCAqIGFzIGFjdGlvbnMgZnJvbSAnc3RhdGVzL3NvbmdzL2FjdGlvbnMnO1xuaW1wb3J0IHNlYXJjaCBmcm9tICdhcGkvc29uZ3MnO1xuXG50eXBlIEFjdGlvbnMgPSBBY3Rpb25zT2Y8dHlwZW9mIGFjdGlvbnM+O1xuXG5leHBvcnQgY29uc3QgZmV0Y2hFcGljOiBFcGljPFxuICBSb290QWN0aW9ucyxcbiAgQWN0aW9ucyxcbiAgUm9vdFN0YXRlXG4+ID0gYWN0aW9uJCA9PiAoXG4gIGFjdGlvbiRcbiAgICAuZmlsdGVyKGlzQWN0aW9uT2YoYWN0aW9ucy5zb25nc0ZldGNoKSlcbiAgICAubWVyZ2VNYXAoKHsgcGF5bG9hZCB9KSA9PiAoXG4gICAgICBSeC5PYnNlcnZhYmxlLmNvbmNhdDxBY3Rpb25zPihcbiAgICAgICAgUnguT2JzZXJ2YWJsZS5vZihhY3Rpb25zLnNvbmdzRmV0Y2hMb2FkaW5nKCkpLFxuICAgICAgICBSeC5PYnNlcnZhYmxlLmZyb21Qcm9taXNlKHNlYXJjaC5nZXQocGF5bG9hZCkpXG4gICAgICAgICAgLm1lcmdlTWFwKHJlc3BvbnNlID0+IChcbiAgICAgICAgICAgIFJ4Lk9ic2VydmFibGUuY29uY2F0PEFjdGlvbnM+KFxuICAgICAgICAgICAgICBSeC5PYnNlcnZhYmxlLm9mKGFjdGlvbnMuc29uZ3NSZWNlaXZlKHJlc3BvbnNlKSksXG4gICAgICAgICAgICAgIFJ4Lk9ic2VydmFibGUub2YoYWN0aW9ucy5zb25nc0ZldGNoU3VjY2VzcygpKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICkpXG4gICAgICAgICAgLmNhdGNoKChyZXF1ZXN0RXJyb3I6IFJlcXVlc3RFcnJvcikgPT4gKFxuICAgICAgICAgICAgUnguT2JzZXJ2YWJsZS5mcm9tUHJvbWlzZShwYXJzZVJlcXVlc3RFcnJvcihyZXF1ZXN0RXJyb3IpXG4gICAgICAgICAgICAgIC50aGVuKGVycm9yID0+IGFjdGlvbnMuc29uZ3NGZXRjaEZhaWx1cmUoZXJyb3IpKVxuICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gYWN0aW9ucy5zb25nc0ZldGNoRmFpbHVyZShlcnJvcikpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKSlcbiAgICAgIClcbiAgICApKVxuKTtcblxuIl19