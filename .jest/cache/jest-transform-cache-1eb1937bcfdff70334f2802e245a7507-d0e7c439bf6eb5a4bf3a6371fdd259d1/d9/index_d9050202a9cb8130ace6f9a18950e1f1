a4ce9b700e6a7a38d89d2b3183323683
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.fetchEpic = void 0;

var Rx = _interopRequireWildcard(require("rxjs"));

var _error = require("../../../../utils/request/error");

var _action = require("../../../utils/action");

var actions = _interopRequireWildcard(require("../../actions"));

var _songs = _interopRequireDefault(require("../../../../api/songs"));

var fetchEpic = function fetchEpic(action$) {
  return action$.filter((0, _action.isActionOf)(actions.fetch)).mergeMap(function (_ref) {
    var payload = _ref.payload;
    return Rx.Observable.concat(Rx.Observable.of(actions.fetchLoading()), Rx.Observable.fromPromise(_songs.default.get(payload)).mergeMap(function (response) {
      return Rx.Observable.concat(Rx.Observable.of(actions.receive(response)), Rx.Observable.of(actions.fetchSuccess()));
    }).catch(function (requestError) {
      return Rx.Observable.fromPromise((0, _error.parseRequestError)(requestError).then(function (error) {
        return actions.fetchFailure(error);
      }).catch(function (error) {
        return actions.fetchFailure(error);
      }));
    }));
  });
};

exports.fetchEpic = fetchEpic;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9rZWlzdWtla2lkby9wcm9qZWN0cy9pdHVuZXNGZXRjaGVyL3NyYy9zdGF0ZXMvc29uZ3MvZXBpYy9mZXRjaC9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFJQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFJTyxJQUFNLFNBQVMsR0FJbEIsU0FKUyxTQUlULENBQUEsT0FBTztBQUFBLFNBQ1QsT0FBTyxDQUNKLE1BREgsQ0FDVSx3QkFBVyxPQUFPLENBQUMsS0FBbkIsQ0FEVixFQUVHLFFBRkgsQ0FFWTtBQUFBLFFBQUcsT0FBSCxRQUFHLE9BQUg7QUFBQSxXQUNSLEVBQUUsQ0FBQyxVQUFILENBQWMsTUFBZCxDQUNFLEVBQUUsQ0FBQyxVQUFILENBQWMsRUFBZCxDQUFpQixPQUFPLENBQUMsWUFBUixFQUFqQixDQURGLEVBRUUsRUFBRSxDQUFDLFVBQUgsQ0FBYyxXQUFkLENBQTBCLGVBQU8sR0FBUCxDQUFXLE9BQVgsQ0FBMUIsRUFDRyxRQURILENBQ1ksVUFBQSxRQUFRO0FBQUEsYUFDaEIsRUFBRSxDQUFDLFVBQUgsQ0FBYyxNQUFkLENBQ0UsRUFBRSxDQUFDLFVBQUgsQ0FBYyxFQUFkLENBQWlCLE9BQU8sQ0FBQyxPQUFSLENBQWdCLFFBQWhCLENBQWpCLENBREYsRUFFRSxFQUFFLENBQUMsVUFBSCxDQUFjLEVBQWQsQ0FBaUIsT0FBTyxDQUFDLFlBQVIsRUFBakIsQ0FGRixDQURnQjtBQUFBLEtBRHBCLEVBT0csS0FQSCxDQU9TLFVBQUMsWUFBRDtBQUFBLGFBQ0wsRUFBRSxDQUFDLFVBQUgsQ0FBYyxXQUFkLENBQTBCLDhCQUFrQixZQUFsQixFQUN2QixJQUR1QixDQUNsQixVQUFBLEtBQUs7QUFBQSxlQUFJLE9BQU8sQ0FBQyxZQUFSLENBQXFCLEtBQXJCLENBQUo7QUFBQSxPQURhLEVBRXZCLEtBRnVCLENBRWpCLFVBQUEsS0FBSztBQUFBLGVBQUksT0FBTyxDQUFDLFlBQVIsQ0FBcUIsS0FBckIsQ0FBSjtBQUFBLE9BRlksQ0FBMUIsQ0FESztBQUFBLEtBUFQsQ0FGRixDQURRO0FBQUEsR0FGWixDQURTO0FBQUEsQ0FKSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJ4IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgRXBpYyB9IGZyb20gJ3JlZHV4LW9ic2VydmFibGUnO1xuaW1wb3J0IHsgQWN0aW9uc09mIH0gZnJvbSAndHlwZXMvc3RhdGUnO1xuaW1wb3J0IHsgUmVxdWVzdEVycm9yIH0gZnJvbSAndHlwZXMvcmVxdWVzdCc7XG5pbXBvcnQgeyBwYXJzZVJlcXVlc3RFcnJvciB9IGZyb20gJ3V0aWxzL3JlcXVlc3QvZXJyb3InO1xuaW1wb3J0IHsgaXNBY3Rpb25PZiB9IGZyb20gJ3N0YXRlcy91dGlscy9hY3Rpb24nO1xuaW1wb3J0IHsgUm9vdFN0YXRlIH0gZnJvbSAnc3RhdGVzL3Jvb3QvcmVkdWNlcic7XG5pbXBvcnQgKiBhcyBhY3Rpb25zIGZyb20gJ3N0YXRlcy9zb25ncy9hY3Rpb25zJztcbmltcG9ydCBzZWFyY2ggZnJvbSAnYXBpL3NvbmdzJztcblxudHlwZSBBY3Rpb25zID0gQWN0aW9uc09mPHR5cGVvZiBhY3Rpb25zPjtcblxuZXhwb3J0IGNvbnN0IGZldGNoRXBpYzogRXBpYzxcbiAgQWN0aW9ucyxcbiAgQWN0aW9ucyxcbiAgUm9vdFN0YXRlXG4+ID0gYWN0aW9uJCA9PiAoXG4gIGFjdGlvbiRcbiAgICAuZmlsdGVyKGlzQWN0aW9uT2YoYWN0aW9ucy5mZXRjaCkpXG4gICAgLm1lcmdlTWFwKCh7IHBheWxvYWQgfSkgPT4gKFxuICAgICAgUnguT2JzZXJ2YWJsZS5jb25jYXQ8QWN0aW9ucz4oXG4gICAgICAgIFJ4Lk9ic2VydmFibGUub2YoYWN0aW9ucy5mZXRjaExvYWRpbmcoKSksXG4gICAgICAgIFJ4Lk9ic2VydmFibGUuZnJvbVByb21pc2Uoc2VhcmNoLmdldChwYXlsb2FkKSlcbiAgICAgICAgICAubWVyZ2VNYXAocmVzcG9uc2UgPT4gKFxuICAgICAgICAgICAgUnguT2JzZXJ2YWJsZS5jb25jYXQ8QWN0aW9ucz4oXG4gICAgICAgICAgICAgIFJ4Lk9ic2VydmFibGUub2YoYWN0aW9ucy5yZWNlaXZlKHJlc3BvbnNlKSksXG4gICAgICAgICAgICAgIFJ4Lk9ic2VydmFibGUub2YoYWN0aW9ucy5mZXRjaFN1Y2Nlc3MoKSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApKVxuICAgICAgICAgIC5jYXRjaCgocmVxdWVzdEVycm9yOiBSZXF1ZXN0RXJyb3IpID0+IChcbiAgICAgICAgICAgIFJ4Lk9ic2VydmFibGUuZnJvbVByb21pc2UocGFyc2VSZXF1ZXN0RXJyb3IocmVxdWVzdEVycm9yKVxuICAgICAgICAgICAgICAudGhlbihlcnJvciA9PiBhY3Rpb25zLmZldGNoRmFpbHVyZShlcnJvcikpXG4gICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiBhY3Rpb25zLmZldGNoRmFpbHVyZShlcnJvcikpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKSlcbiAgICAgIClcbiAgICApKVxuKTtcblxuIl19